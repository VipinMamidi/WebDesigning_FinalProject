{"ast":null,"code":"import _toConsumableArray from\"/Users/riddhibhatti/Webdesign/WebDFinalProject/WebDesigning_FinalProject/TheStyleStudio/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _createForOfIteratorHelper from\"/Users/riddhibhatti/Webdesign/WebDFinalProject/WebDesigning_FinalProject/TheStyleStudio/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _slicedToArray from\"/Users/riddhibhatti/Webdesign/WebDFinalProject/WebDesigning_FinalProject/TheStyleStudio/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";/* eslint-disable array-callback-return */import React,{useState,useEffect}from\"react\";import{useDispatch,useSelector}from\"react-redux\";import{Link}from\"react-router-dom\";import{Row,Col,Card,Button,ListGroup,Form,FloatingLabel}from\"react-bootstrap\";import ImageMagnifier from\"../components/ImageMagnifier\";// to magnify image on hover\nimport Rating from\"../components/Rating\";import Meta from\"../components/Meta\";import Loader from\"../components/Loader\";import Message from\"../components/Message\";import{listProductDetails,createProductReview}from\"../actions/productActions\";import{listMyOrders}from\"../actions/orderActions\";import{refreshLogin,getUserDetails}from\"../actions/userActions\";import{PRODUCT_CREATE_REVIEW_RESET}from\"../constants/productConstants\";import getDateString from\"../utils/getDateString\";import\"../styles/product-page.css\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var ProductPage=function ProductPage(_ref){var history=_ref.history,match=_ref.match;var _useState=useState(1),_useState2=_slicedToArray(_useState,2),quantity=_useState2[0],setQuantity=_useState2[1];var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),rating=_useState4[0],setRating=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),review=_useState6[0],setReview=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),allReviews=_useState8[0],setAllReviews=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),hasOrderedItem=_useState10[0],setHasOrderedItem=_useState10[1];// bool to check if the user has ordered this product\nvar _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),showReviewForm=_useState12[0],setShowReviewForm=_useState12[1];// bool to decide whether to show the review form or not\nvar dispatch=useDispatch();var userLogin=useSelector(function(state){return state.userLogin;});var userInfo=userLogin.userInfo;var productDetails=useSelector(function(state){return state.productDetails;});var loading=productDetails.loading,product=productDetails.product,error=productDetails.error;var userDetails=useSelector(function(state){return state.userDetails;});var userLoginError=userDetails.error;var productCreateReview=useSelector(function(state){return state.productCreateReview;});var loadingCreateReview=productCreateReview.loading,successCreateReview=productCreateReview.success,errorCreateReview=productCreateReview.error;var orderListUser=useSelector(function(state){return state.orderListUser;});var orders=orderListUser.orders;// fetch user login info\nuseEffect(function(){userInfo?userInfo.isSocialLogin?dispatch(getUserDetails(userInfo.id)):dispatch(getUserDetails(\"profile\")):dispatch(getUserDetails(\"profile\"));},[userInfo,dispatch]);// refresh the access tokens for accessing user details\nuseEffect(function(){if(userLoginError&&userInfo&&!userInfo.isSocialLogin){var user=JSON.parse(localStorage.getItem(\"userInfo\"));user&&dispatch(refreshLogin(user.email));}},[userLoginError,dispatch,userInfo]);useEffect(function(){dispatch(listMyOrders());},[dispatch]);// add a new review, and reset the stored product review in the redux store\nuseEffect(function(){if(successCreateReview){window.alert(\"Review Submitted!!\");setRating(0);setReview(\"\");dispatch({type:PRODUCT_CREATE_REVIEW_RESET});}dispatch(listProductDetails(match.params.id));},[match,dispatch,successCreateReview]);useEffect(function(){if(product&&product.reviews&&userInfo){var flag=0;// to check if this user has already reviewed this product\nvar _iterator=_createForOfIteratorHelper(product.reviews),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var _review=_step.value;if(_review.user===userInfo.id){flag=1;break;}}}catch(err){_iterator.e(err);}finally{_iterator.f();}flag?setShowReviewForm(false):setShowReviewForm(true);}else{setShowReviewForm(true);}},[product,userInfo]);useEffect(function(){if(orders&&orders.length){var flag=0;// to check is this user has ordered this item\nvar _iterator2=_createForOfIteratorHelper(orders),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var obj=_step2.value;var _iterator3=_createForOfIteratorHelper(obj.orderItems),_step3;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var ele=_step3.value;if(ele.product.toString()===match.params.id){flag=1;break;}}}catch(err){_iterator3.e(err);}finally{_iterator3.f();}}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}flag?setHasOrderedItem(true):setHasOrderedItem(false);}else{setHasOrderedItem(false);}// eslint-disable-next-line react-hooks/exhaustive-deps\n},[orders]);// arrange all reviews in reverse chronological order\nuseEffect(function(){if(product&&product.reviews){var sortedArr=product.reviews.sort(function(a,b){return new Date(b.createdAt)-new Date(a.createdAt);});setAllReviews(sortedArr);}},[product]);var handleAddToCart=function handleAddToCart(e){history.push(\"/cart/\".concat(match.params.id,\"?qty=\").concat(quantity));};var handleReviewSubmit=function handleReviewSubmit(e){dispatch(createProductReview(match.params.id,{rating:rating,review:review}));};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Link,{className:\"btn btn-outline-primary my-2\",to:\"/\",children:\"Go Back\"}),product&&(!product._id||product._id!==match.params.id)?/*#__PURE__*/_jsx(Loader,{}):error?/*#__PURE__*/_jsx(Message,{dismissible:true,variant:\"danger\",duration:10,children:error}):product?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Meta,{title:\"\".concat(product.name)}),/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{md:6,children:/*#__PURE__*/_jsx(ImageMagnifier,{src:product.image,alt:product.name,title:product.name})}),/*#__PURE__*/_jsx(Col,{md:3,children:/*#__PURE__*/_jsxs(ListGroup,{variant:\"flush\",children:[/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsx(\"h3\",{children:product.name})}),/*#__PURE__*/_jsx(ListGroup.Item,{children:product&&product.rating&&/*#__PURE__*/_jsx(Rating,{value:product.rating,text:\"\".concat(product.numReviews,\" Review\").concat(product.numReviews>1?\"s\":\"\")})}),/*#__PURE__*/_jsxs(ListGroup.Item,{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Price: \"}),product.price&&product.price.toLocaleString(\"en-US\",{maximumFractionDigits:2,style:\"currency\",currency:\"USD\"})]}),/*#__PURE__*/_jsxs(ListGroup.Item,{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Description:\"}),\" \",product.description]})]})}),/*#__PURE__*/_jsx(Col,{md:3,children:/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(ListGroup,{variant:\"flush\",children:/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsx(\"strong\",{children:\"Price: \"})}),/*#__PURE__*/_jsx(Col,{children:product.price&&product.price.toLocaleString(\"en-US\",{maximumFractionDigits:2,style:\"currency\",currency:\"USD\"})})]})})}),/*#__PURE__*/_jsxs(ListGroup,{variant:\"flush\",children:[/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsx(\"strong\",{children:\"Status: \"})}),/*#__PURE__*/_jsx(Col,{children:product.countInStock>0?\"In Stock\":\"Out of Stock\"})]})}),product.countInStock>0&&/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsx(\"strong\",{children:\"Qty:\"})}),/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsx(Form.Control,{as:\"select\",value:quantity,onChange:function onChange(e){return setQuantity(e.target.value);},children:_toConsumableArray(Array(product.countInStock).keys()).map(function(ele){return/*#__PURE__*/_jsx(\"option\",{value:ele+1,children:ele+1},ele+1);})})})]})}),/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsx(Row,{children:/*#__PURE__*/_jsx(Button,{onClick:handleAddToCart,type:\"button\",className:\"btn-block btn-lg\",disabled:product.countInStock<=0,children:\"Add To Cart\"})})})]})]})})]}),/*#__PURE__*/_jsx(Row,{children:/*#__PURE__*/_jsxs(Col,{md:6,children:[/*#__PURE__*/_jsx(\"h2\",{className:\"mt-3\",children:\"Reviews\"}),(!product.reviews||!product.reviews.length)&&/*#__PURE__*/_jsx(Message,{variant:\"secondary\",children:\"No Reviews Yet\"}),/*#__PURE__*/_jsxs(ListGroup,{variant:\"flush\",children:[allReviews.map(function(item){return/*#__PURE__*/_jsxs(ListGroup.Item,{children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"img\",{src:item.avatar,alt:item.name,className:\"review-avatar\"}),/*#__PURE__*/_jsx(\"strong\",{children:item.name})]}),/*#__PURE__*/_jsx(Rating,{value:item.rating}),/*#__PURE__*/_jsx(\"p\",{style:{margin:\"0\",fontSize:\"1.1em\"},children:item.review}),/*#__PURE__*/_jsx(\"small\",{style:{fontSize:\"0.9em\"},children:getDateString(item.createdAt,false)})]},item._id);}),hasOrderedItem&&!showReviewForm&&/*#__PURE__*/_jsx(Message,{dismissible:true,children:\"You have already reviewed this product\"}),hasOrderedItem&&showReviewForm&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Write a Customer Review\"}),errorCreateReview&&/*#__PURE__*/_jsx(Message,{dismissible:true,variant:\"info\",duration:10,children:errorCreateReview}),loadingCreateReview&&/*#__PURE__*/_jsx(Loader,{}),/*#__PURE__*/_jsxs(Form,{onSubmit:handleReviewSubmit,children:[/*#__PURE__*/_jsx(Form.Group,{controlId:\"rating\",children:/*#__PURE__*/_jsxs(Form.Control,{as:\"select\",value:rating,onChange:function onChange(e){return setRating(e.target.value);},children:[/*#__PURE__*/_jsx(\"option\",{default:true,children:\"Choose Rating\"}),/*#__PURE__*/_jsx(\"option\",{value:\"1\",children:\"1 - Bad\"}),/*#__PURE__*/_jsx(\"option\",{value:\"2\",children:\"2 - Poor\"}),/*#__PURE__*/_jsx(\"option\",{value:\"3\",children:\"3 - Fair\"}),/*#__PURE__*/_jsx(\"option\",{value:\"4\",children:\"4 - Good\"}),/*#__PURE__*/_jsx(\"option\",{value:\"5\",children:\"5 - Excellent\"})]})}),/*#__PURE__*/_jsx(Form.Group,{controlId:\"comment\",children:/*#__PURE__*/_jsx(FloatingLabel,{controlId:\"commenttext\",label:\"Comment\",className:\"my-3\",children:/*#__PURE__*/_jsx(Form.Control,{as:\"textarea\",placeholder:\"Leave a comment here\",row:\"3\",onChange:function onChange(e){return setReview(e.target.value);},value:review})})}),/*#__PURE__*/_jsx(\"div\",{className:\"d-grid\",children:/*#__PURE__*/_jsx(Button,{type:\"submit\",children:\"Submit Review\"})})]})]})]})]})})]}):\"\"]});};export default ProductPage;","map":{"version":3,"sources":["/Users/riddhibhatti/Webdesign/WebDFinalProject/WebDesigning_FinalProject/TheStyleStudio/frontend/src/pages/ProductPage.js"],"names":["React","useState","useEffect","useDispatch","useSelector","Link","Row","Col","Card","Button","ListGroup","Form","FloatingLabel","ImageMagnifier","Rating","Meta","Loader","Message","listProductDetails","createProductReview","listMyOrders","refreshLogin","getUserDetails","PRODUCT_CREATE_REVIEW_RESET","getDateString","ProductPage","history","match","quantity","setQuantity","rating","setRating","review","setReview","allReviews","setAllReviews","hasOrderedItem","setHasOrderedItem","showReviewForm","setShowReviewForm","dispatch","userLogin","state","userInfo","productDetails","loading","product","error","userDetails","userLoginError","productCreateReview","loadingCreateReview","successCreateReview","success","errorCreateReview","orderListUser","orders","isSocialLogin","id","user","JSON","parse","localStorage","getItem","email","window","alert","type","params","reviews","flag","length","obj","orderItems","ele","toString","sortedArr","sort","a","b","Date","createdAt","handleAddToCart","e","push","handleReviewSubmit","_id","name","image","numReviews","price","toLocaleString","maximumFractionDigits","style","currency","description","countInStock","target","value","Array","keys","map","item","avatar","margin","fontSize"],"mappings":"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","sourcesContent":["/* eslint-disable array-callback-return */\r\nimport React, { useState, useEffect } from \"react\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { Link } from \"react-router-dom\";\r\nimport {\r\n  Row,\r\n  Col,\r\n  Card,\r\n  Button,\r\n  ListGroup,\r\n  Form,\r\n  FloatingLabel,\r\n} from \"react-bootstrap\";\r\nimport ImageMagnifier from \"../components/ImageMagnifier\"; // to magnify image on hover\r\nimport Rating from \"../components/Rating\";\r\nimport Meta from \"../components/Meta\";\r\nimport Loader from \"../components/Loader\";\r\nimport Message from \"../components/Message\";\r\nimport {\r\n  listProductDetails,\r\n  createProductReview,\r\n} from \"../actions/productActions\";\r\nimport { listMyOrders } from \"../actions/orderActions\";\r\nimport { refreshLogin, getUserDetails } from \"../actions/userActions\";\r\nimport { PRODUCT_CREATE_REVIEW_RESET } from \"../constants/productConstants\";\r\nimport getDateString from \"../utils/getDateString\";\r\nimport \"../styles/product-page.css\";\r\n\r\nconst ProductPage = ({ history, match }) => {\r\n  const [quantity, setQuantity] = useState(1);\r\n  const [rating, setRating] = useState(0);\r\n  const [review, setReview] = useState(\"\");\r\n  const [allReviews, setAllReviews] = useState([]);\r\n  const [hasOrderedItem, setHasOrderedItem] = useState(false); // bool to check if the user has ordered this product\r\n  const [showReviewForm, setShowReviewForm] = useState(false); // bool to decide whether to show the review form or not\r\n  const dispatch = useDispatch();\r\n\r\n  const userLogin = useSelector((state) => state.userLogin);\r\n  const { userInfo } = userLogin;\r\n\r\n  const productDetails = useSelector((state) => state.productDetails);\r\n  const { loading, product, error } = productDetails;\r\n\r\n  const userDetails = useSelector((state) => state.userDetails);\r\n  const { error: userLoginError } = userDetails;\r\n\r\n  const productCreateReview = useSelector((state) => state.productCreateReview);\r\n  const {\r\n    loading: loadingCreateReview,\r\n    success: successCreateReview,\r\n    error: errorCreateReview,\r\n  } = productCreateReview;\r\n\r\n  const orderListUser = useSelector((state) => state.orderListUser);\r\n  const { orders } = orderListUser;\r\n\r\n  // fetch user login info\r\n  useEffect(() => {\r\n    userInfo\r\n      ? userInfo.isSocialLogin\r\n        ? dispatch(getUserDetails(userInfo.id))\r\n        : dispatch(getUserDetails(\"profile\"))\r\n      : dispatch(getUserDetails(\"profile\"));\r\n  }, [userInfo, dispatch]);\r\n\r\n  // refresh the access tokens for accessing user details\r\n  useEffect(() => {\r\n    if (userLoginError && userInfo && !userInfo.isSocialLogin) {\r\n      const user = JSON.parse(localStorage.getItem(\"userInfo\"));\r\n      user && dispatch(refreshLogin(user.email));\r\n    }\r\n  }, [userLoginError, dispatch, userInfo]);\r\n\r\n  useEffect(() => {\r\n    dispatch(listMyOrders());\r\n  }, [dispatch]);\r\n\r\n  // add a new review, and reset the stored product review in the redux store\r\n  useEffect(() => {\r\n    if (successCreateReview) {\r\n      window.alert(\"Review Submitted!!\");\r\n      setRating(0);\r\n      setReview(\"\");\r\n      dispatch({ type: PRODUCT_CREATE_REVIEW_RESET });\r\n    }\r\n    dispatch(listProductDetails(match.params.id));\r\n  }, [match, dispatch, successCreateReview]);\r\n\r\n  useEffect(() => {\r\n    if (product && product.reviews && userInfo) {\r\n      let flag = 0; // to check if this user has already reviewed this product\r\n      for (let review of product.reviews) {\r\n        if (review.user === userInfo.id) {\r\n          flag = 1;\r\n          break;\r\n        }\r\n      }\r\n      flag ? setShowReviewForm(false) : setShowReviewForm(true);\r\n    } else {\r\n      setShowReviewForm(true);\r\n    }\r\n  }, [product, userInfo]);\r\n\r\n  useEffect(() => {\r\n    if (orders && orders.length) {\r\n      let flag = 0; // to check is this user has ordered this item\r\n      for (let obj of orders) {\r\n        for (let ele of obj.orderItems) {\r\n          if (ele.product.toString() === match.params.id) {\r\n            flag = 1;\r\n            break;\r\n          }\r\n        }\r\n      }\r\n      flag ? setHasOrderedItem(true) : setHasOrderedItem(false);\r\n    } else {\r\n      setHasOrderedItem(false);\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [orders]);\r\n\r\n  // arrange all reviews in reverse chronological order\r\n  useEffect(() => {\r\n    if (product && product.reviews) {\r\n      const sortedArr = product.reviews.sort(\r\n        (a, b) => new Date(b.createdAt) - new Date(a.createdAt)\r\n      );\r\n      setAllReviews(sortedArr);\r\n    }\r\n  }, [product]);\r\n\r\n  const handleAddToCart = (e) => {\r\n    history.push(`/cart/${match.params.id}?qty=${quantity}`);\r\n  };\r\n\r\n  const handleReviewSubmit = (e) => {\r\n    dispatch(\r\n      createProductReview(match.params.id, {\r\n        rating,\r\n        review,\r\n      })\r\n    );\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <Link className=\"btn btn-outline-primary my-2\" to=\"/\">\r\n        Go Back\r\n      </Link>\r\n      {product && (!product._id || product._id !== match.params.id) ? (\r\n        <Loader />\r\n      ) : error ? (\r\n        <Message dismissible variant=\"danger\" duration={10}>\r\n          {error}\r\n        </Message>\r\n      ) : product ? (\r\n        <>\r\n          <Meta title={`${product.name}`} />\r\n          <Row>\r\n            <Col md={6}>\r\n              <ImageMagnifier\r\n                src={product.image}\r\n                alt={product.name}\r\n                title={product.name}\r\n              />\r\n            </Col>\r\n            <Col md={3}>\r\n              <ListGroup variant=\"flush\">\r\n                <ListGroup.Item>\r\n                  <h3>{product.name}</h3>\r\n                </ListGroup.Item>\r\n                <ListGroup.Item>\r\n                  {product && product.rating && (\r\n                    <Rating\r\n                      value={product.rating}\r\n                      text={`${product.numReviews} Review${\r\n                        product.numReviews > 1 ? \"s\" : \"\"\r\n                      }`}\r\n                    />\r\n                  )}\r\n                </ListGroup.Item>\r\n                <ListGroup.Item>\r\n                  <strong>Price: </strong>\r\n                  {product.price &&\r\n                    product.price.toLocaleString(\"en-US\", {\r\n                      maximumFractionDigits: 2,\r\n                      style: \"currency\",\r\n                      currency: \"USD\",\r\n                    })}\r\n                </ListGroup.Item>\r\n                <ListGroup.Item>\r\n                  <strong>Description:</strong> {product.description}\r\n                </ListGroup.Item>\r\n              </ListGroup>\r\n            </Col>\r\n            <Col md={3}>\r\n              <Card>\r\n                <ListGroup variant=\"flush\">\r\n                  <ListGroup.Item>\r\n                    <Row>\r\n                      <Col>\r\n                        <strong>Price: </strong>\r\n                      </Col>\r\n                      <Col>\r\n                        {product.price &&\r\n                          product.price.toLocaleString(\"en-US\", {\r\n                            maximumFractionDigits: 2,\r\n                            style: \"currency\",\r\n                            currency: \"USD\",\r\n                          })}\r\n                      </Col>\r\n                    </Row>\r\n                  </ListGroup.Item>\r\n                </ListGroup>\r\n                <ListGroup variant=\"flush\">\r\n                  <ListGroup.Item>\r\n                    <Row>\r\n                      <Col>\r\n                        <strong>Status: </strong>\r\n                      </Col>\r\n                      <Col>\r\n                        {product.countInStock > 0 ? \"In Stock\" : \"Out of Stock\"}\r\n                      </Col>\r\n                    </Row>\r\n                  </ListGroup.Item>\r\n                  {product.countInStock > 0 && (\r\n                    <ListGroup.Item>\r\n                      <Row>\r\n                        <Col>\r\n                          <strong>Qty:</strong>\r\n                        </Col>\r\n                        <Col>\r\n                          <Form.Control\r\n                            as=\"select\"\r\n                            value={quantity}\r\n                            onChange={(e) => setQuantity(e.target.value)}\r\n                          >\r\n                            {/* create as many options as the countInStock */}\r\n                            {[...Array(product.countInStock).keys()].map(\r\n                              (ele) => (\r\n                                <option key={ele + 1} value={ele + 1}>\r\n                                  {ele + 1}\r\n                                </option>\r\n                              )\r\n                            )}\r\n                          </Form.Control>\r\n                        </Col>\r\n                      </Row>\r\n                    </ListGroup.Item>\r\n                  )}\r\n                  <ListGroup.Item>\r\n                    <Row>\r\n                      <Button\r\n                        onClick={handleAddToCart}\r\n                        type=\"button\"\r\n                        className=\"btn-block btn-lg\"\r\n                        disabled={product.countInStock <= 0}\r\n                      >\r\n                        Add To Cart\r\n                      </Button>\r\n                    </Row>\r\n                  </ListGroup.Item>\r\n                </ListGroup>\r\n              </Card>\r\n            </Col>\r\n          </Row>\r\n          <Row>\r\n            <Col md={6}>\r\n              <h2 className=\"mt-3\">Reviews</h2>\r\n              {(!product.reviews || !product.reviews.length) && (\r\n                <Message variant=\"secondary\">No Reviews Yet</Message>\r\n              )}\r\n              <ListGroup variant=\"flush\">\r\n                {/* {console.log(\r\n\t\t\t\t\t\t\t\t\tproduct.reviews.\r\n\t\t\t\t\t\t\t\t)} */}\r\n                {allReviews.map((item) => {\r\n                  return (\r\n                    <ListGroup.Item key={item._id}>\r\n                      <div>\r\n                        <img\r\n                          src={item.avatar}\r\n                          alt={item.name}\r\n                          className=\"review-avatar\"\r\n                        />\r\n                        <strong>{item.name}</strong>\r\n                      </div>\r\n                      <Rating value={item.rating} />\r\n                      <p\r\n                        style={{\r\n                          margin: \"0\",\r\n                          fontSize: \"1.1em\",\r\n                        }}\r\n                      >\r\n                        {item.review}\r\n                      </p>\r\n                      <small\r\n                        style={{\r\n                          fontSize: \"0.9em\",\r\n                        }}\r\n                      >\r\n                        {getDateString(item.createdAt, false)}\r\n                      </small>\r\n                    </ListGroup.Item>\r\n                  );\r\n                })}\r\n                {hasOrderedItem && !showReviewForm && (\r\n                  <Message dismissible>\r\n                    You have already reviewed this product\r\n                  </Message>\r\n                )}\r\n                {hasOrderedItem && showReviewForm && (\r\n                  <>\r\n                    <h2>Write a Customer Review</h2>\r\n                    {errorCreateReview && (\r\n                      <Message dismissible variant=\"info\" duration={10}>\r\n                        {errorCreateReview}\r\n                      </Message>\r\n                    )}\r\n                    {loadingCreateReview && <Loader />}\r\n                    <Form onSubmit={handleReviewSubmit}>\r\n                      <Form.Group controlId=\"rating\">\r\n                        <Form.Control\r\n                          as=\"select\"\r\n                          value={rating}\r\n                          onChange={(e) => setRating(e.target.value)}\r\n                        >\r\n                          <option default>Choose Rating</option>\r\n                          <option value=\"1\">1 - Bad</option>\r\n                          <option value=\"2\">2 - Poor</option>\r\n                          <option value=\"3\">3 - Fair</option>\r\n                          <option value=\"4\">4 - Good</option>\r\n                          <option value=\"5\">5 - Excellent</option>\r\n                        </Form.Control>\r\n                      </Form.Group>\r\n                      <Form.Group controlId=\"comment\">\r\n                        <FloatingLabel\r\n                          controlId=\"commenttext\"\r\n                          label=\"Comment\"\r\n                          className=\"my-3\"\r\n                        >\r\n                          <Form.Control\r\n                            as=\"textarea\"\r\n                            placeholder=\"Leave a comment here\"\r\n                            row=\"3\"\r\n                            onChange={(e) => setReview(e.target.value)}\r\n                            value={review}\r\n                          />\r\n                        </FloatingLabel>\r\n                      </Form.Group>\r\n                      <div className=\"d-grid\">\r\n                        <Button type=\"submit\">Submit Review</Button>\r\n                      </div>\r\n                    </Form>\r\n                  </>\r\n                )}\r\n              </ListGroup>\r\n            </Col>\r\n          </Row>\r\n        </>\r\n      ) : (\r\n        \"\"\r\n      )}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default ProductPage;\r\n"]},"metadata":{},"sourceType":"module"}