{"ast":null,"code":"import _slicedToArray from\"/Users/riddhibhatti/Webdesign/WebDFinalProject/WebDesigning_FinalProject/TheStyleStudio/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState,useEffect}from\"react\";import{Link}from\"react-router-dom\";import{Row,Col,Image,ButtonGroup,ListGroup,Button,Card}from\"react-bootstrap\";import{useDispatch,useSelector}from\"react-redux\";import Meta from\"../components/Meta\";import Message from\"../components/Message\";import{refreshLogin,getUserDetails}from\"../actions/userActions\";import{addItem,removeItem}from\"../actions/cartActions\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var CartPage=function CartPage(_ref){var match=_ref.match,location=_ref.location,history=_ref.history;var _useState=useState(0),_useState2=_slicedToArray(_useState,2),totalItems=_useState2[0],setTotalItems=_useState2[1];var productID=match.params.id;var qty=location.search?Number(location.search.split(\"=\")[1]):1;// fetch from the query string\nvar dispatch=useDispatch();// get cart, userInfo and userdetails from redux store\nvar cart=useSelector(function(state){return state.cart;});var cartItems=cart.cartItems;var userLogin=useSelector(function(state){return state.userLogin;});var userInfo=userLogin.userInfo;var userDetails=useSelector(function(state){return state.userDetails;});var error=userDetails.error;// get user details depending on what type of login it is, dispatch with correspnding argument\nuseEffect(function(){userInfo?userInfo.isSocialLogin?dispatch(getUserDetails(userInfo.id)):dispatch(getUserDetails(\"profile\")):dispatch(getUserDetails(\"profile\"));},[userInfo,dispatch]);// store total items to local state\nuseEffect(function(){if(cartItems){setTotalItems(cartItems.reduce(function(acc,item){return acc+item.qty;},0));}},[cartItems]);// if userdetails shows error, then use refresh token to get new access tokens\nuseEffect(function(){if(error&&userInfo&&!userInfo.isSocialLogin){var user=JSON.parse(localStorage.getItem(\"userInfo\"));user&&dispatch(refreshLogin(user.email));}},[error,dispatch,userInfo]);// add item to cart\nuseEffect(function(){if(productID){dispatch(addItem(productID,qty));}},[dispatch,productID,qty]);// remove item from cart\nvar handleRemoveFromCart=function handleRemoveFromCart(id){dispatch(removeItem(id));};// proceed to shipping address page, which is the next step in placing an order\nvar handleCheckout=function handleCheckout(e){history.push(\"/login?redirect=shipping\");};return/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Meta,{title:\"My Cart | The Style Studio\"}),/*#__PURE__*/_jsxs(Col,{md:8,children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Shopping Cart.\"}),!cartItems.length?/*#__PURE__*/_jsxs(Message,{children:[\"Your Cart is empty. \",/*#__PURE__*/_jsx(Link,{to:\"/\",children:\"Go Back.\"}),\" \"]}):/*#__PURE__*/_jsx(ListGroup,{variant:\"flush\",children:cartItems.map(function(item){return/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsxs(Row,{style:{display:\"flex\",alignItems:\"center\"},children:[/*#__PURE__*/_jsx(Col,{md:2,children:/*#__PURE__*/_jsx(Image,{className:\"product-image\",src:item.image,alt:item.name,fluid:true,rounded:true})}),/*#__PURE__*/_jsx(Col,{md:4,children:/*#__PURE__*/_jsx(Link,{to:\"/product/\".concat(item.product),children:item.name})}),/*#__PURE__*/_jsxs(Col,{md:3,className:\"d-none d-md-flex\",style:{alignItems:\"center\",justifyContent:\"space-evenly\"},children:[item.price.toLocaleString(\"en-US\",{maximumFractionDigits:2,style:\"currency\",currency:\"USD\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"i\",{style:{fontSize:\"0.7em\"},className:\"fas fa-times\"}),\" \",item.qty]})]}),/*#__PURE__*/_jsxs(Col,{md:3,className:\"d-none d-md-flex\",style:{alignItems:\"center\",justifyContent:\"space-between\"},children:[/*#__PURE__*/_jsxs(ButtonGroup,{\"aria-label\":\"Addtocart\",children:[/*#__PURE__*/_jsx(Button,{style:{outline:\"none\",borderRight:\"1px solid white\"},disabled:item.qty>=item.countInStock,onClick:function onClick(){dispatch(addItem(item.product,Number(item.qty+1)));},variant:\"primary\",children:/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-plus\"})}),/*#__PURE__*/_jsx(Button,{style:{outline:\"none\",borderLeft:\"1px solid white\"},variant:\"primary\",disabled:item.qty===1,onClick:function onClick(){dispatch(addItem(item.product,Number(item.qty-1)));},children:/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-minus\"})})]}),/*#__PURE__*/_jsx(Button,{type:\"button\",onClick:function onClick(){return handleRemoveFromCart(item.product);},children:/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-trash\"})})]}),/*#__PURE__*/_jsxs(Col,{className:\"d-flex d-md-none mt-2\",style:{alignItems:\"center\",justifyContent:\"space-between\"},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex\",style:{fontSize:\"1.2em\",width:\"50%\"},children:[item.price.toLocaleString(\"en-US\",{maximumFractionDigits:2,style:\"currency\",currency:\"USD\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"ms-1\",children:[/*#__PURE__*/_jsx(\"i\",{style:{fontSize:\"0.7em\"},className:\"fas fa-times\"}),\" \",item.qty]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex\",style:{alignItems:\"center\",justifyContent:\"space-between\",width:\"50%\"},children:[/*#__PURE__*/_jsx(Button,{type:\"button\",onClick:function onClick(){return handleRemoveFromCart(item.product);},children:/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-trash\"})}),/*#__PURE__*/_jsx(Button,{style:{outline:\"none\",borderRight:\"1px solid white\"},disabled:item.qty>=item.countInStock,onClick:function onClick(){dispatch(addItem(item.product,Number(item.qty+1)));},variant:\"primary\",children:/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-plus\"})}),/*#__PURE__*/_jsx(Button,{style:{outline:\"none\",borderLeft:\"1px solid white\"},variant:\"primary\",disabled:item.qty===1,onClick:function onClick(){dispatch(addItem(item.product,Number(item.qty-1)));},children:/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-minus\"})})]})]})]})},item.product);})})]}),/*#__PURE__*/_jsx(Col,{md:4,className:\"mt-3\",children:/*#__PURE__*/_jsx(ListGroup,{children:/*#__PURE__*/_jsxs(Card,{variant:\"flush\",children:[/*#__PURE__*/_jsxs(ListGroup.Item,{children:[/*#__PURE__*/_jsxs(\"h2\",{className:\"text-center\",children:[\"Subtotal (\",totalItems,\") Item\",totalItems>1&&\"s\"]}),/*#__PURE__*/_jsx(\"strong\",{children:cartItems.reduce(function(acc,item){return acc+item.qty*item.price;},0).toLocaleString(\"en-US\",{maximumFractionDigits:2,style:\"currency\",currency:\"USD\"})})]}),/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsx(\"div\",{className:\"d-grid\",children:/*#__PURE__*/_jsx(Button,{type:\"button\",size:\"lg\",disabled:!cartItems.length,onClick:handleCheckout,children:\"Proceed to checkout\"})})})]})})})]});};export default CartPage;","map":{"version":3,"sources":["/Users/riddhibhatti/Webdesign/WebDFinalProject/WebDesigning_FinalProject/TheStyleStudio/frontend/src/pages/CartPage.js"],"names":["React","useState","useEffect","Link","Row","Col","Image","ButtonGroup","ListGroup","Button","Card","useDispatch","useSelector","Meta","Message","refreshLogin","getUserDetails","addItem","removeItem","CartPage","match","location","history","totalItems","setTotalItems","productID","params","id","qty","search","Number","split","dispatch","cart","state","cartItems","userLogin","userInfo","userDetails","error","isSocialLogin","reduce","acc","item","user","JSON","parse","localStorage","getItem","email","handleRemoveFromCart","handleCheckout","e","push","length","map","display","alignItems","image","name","product","justifyContent","price","toLocaleString","maximumFractionDigits","style","currency","fontSize","outline","borderRight","countInStock","borderLeft","width"],"mappings":"6KAAA,MAAOA,CAAAA,KAAP,EAAgBC,QAAhB,CAA0BC,SAA1B,KAA2C,OAA3C,CACA,OAASC,IAAT,KAAqB,kBAArB,CACA,OACEC,GADF,CAEEC,GAFF,CAGEC,KAHF,CAIEC,WAJF,CAKEC,SALF,CAMEC,MANF,CAOEC,IAPF,KAQO,iBARP,CASA,OAASC,WAAT,CAAsBC,WAAtB,KAAyC,aAAzC,CACA,MAAOC,CAAAA,IAAP,KAAiB,oBAAjB,CACA,MAAOC,CAAAA,OAAP,KAAoB,uBAApB,CACA,OAASC,YAAT,CAAuBC,cAAvB,KAA6C,wBAA7C,CACA,OAASC,OAAT,CAAkBC,UAAlB,KAAoC,wBAApC,C,wFAEA,GAAMC,CAAAA,QAAQ,CAAG,QAAXA,CAAAA,QAAW,MAAkC,IAA/BC,CAAAA,KAA+B,MAA/BA,KAA+B,CAAxBC,QAAwB,MAAxBA,QAAwB,CAAdC,OAAc,MAAdA,OAAc,CACjD,cAAoCrB,QAAQ,CAAC,CAAD,CAA5C,wCAAOsB,UAAP,eAAmBC,aAAnB,eACA,GAAMC,CAAAA,SAAS,CAAGL,KAAK,CAACM,MAAN,CAAaC,EAA/B,CACA,GAAMC,CAAAA,GAAG,CAAGP,QAAQ,CAACQ,MAAT,CAAkBC,MAAM,CAACT,QAAQ,CAACQ,MAAT,CAAgBE,KAAhB,CAAsB,GAAtB,EAA2B,CAA3B,CAAD,CAAxB,CAA0D,CAAtE,CAAyE;AACzE,GAAMC,CAAAA,QAAQ,CAAGrB,WAAW,EAA5B,CAEA;AACA,GAAMsB,CAAAA,IAAI,CAAGrB,WAAW,CAAC,SAACsB,KAAD,QAAWA,CAAAA,KAAK,CAACD,IAAjB,EAAD,CAAxB,CACA,GAAQE,CAAAA,SAAR,CAAsBF,IAAtB,CAAQE,SAAR,CAEA,GAAMC,CAAAA,SAAS,CAAGxB,WAAW,CAAC,SAACsB,KAAD,QAAWA,CAAAA,KAAK,CAACE,SAAjB,EAAD,CAA7B,CACA,GAAQC,CAAAA,QAAR,CAAqBD,SAArB,CAAQC,QAAR,CAEA,GAAMC,CAAAA,WAAW,CAAG1B,WAAW,CAAC,SAACsB,KAAD,QAAWA,CAAAA,KAAK,CAACI,WAAjB,EAAD,CAA/B,CACA,GAAQC,CAAAA,KAAR,CAAkBD,WAAlB,CAAQC,KAAR,CAEA;AACArC,SAAS,CAAC,UAAM,CACdmC,QAAQ,CACJA,QAAQ,CAACG,aAAT,CACER,QAAQ,CAAChB,cAAc,CAACqB,QAAQ,CAACV,EAAV,CAAf,CADV,CAEEK,QAAQ,CAAChB,cAAc,CAAC,SAAD,CAAf,CAHN,CAIJgB,QAAQ,CAAChB,cAAc,CAAC,SAAD,CAAf,CAJZ,CAKD,CANQ,CAMN,CAACqB,QAAD,CAAWL,QAAX,CANM,CAAT,CAQA;AACA9B,SAAS,CAAC,UAAM,CACd,GAAIiC,SAAJ,CAAe,CACbX,aAAa,CAACW,SAAS,CAACM,MAAV,CAAiB,SAACC,GAAD,CAAMC,IAAN,QAAeD,CAAAA,GAAG,CAAGC,IAAI,CAACf,GAA1B,EAAjB,CAAgD,CAAhD,CAAD,CAAb,CACD,CACF,CAJQ,CAIN,CAACO,SAAD,CAJM,CAAT,CAMA;AACAjC,SAAS,CAAC,UAAM,CACd,GAAIqC,KAAK,EAAIF,QAAT,EAAqB,CAACA,QAAQ,CAACG,aAAnC,CAAkD,CAChD,GAAMI,CAAAA,IAAI,CAAGC,IAAI,CAACC,KAAL,CAAWC,YAAY,CAACC,OAAb,CAAqB,UAArB,CAAX,CAAb,CACAJ,IAAI,EAAIZ,QAAQ,CAACjB,YAAY,CAAC6B,IAAI,CAACK,KAAN,CAAb,CAAhB,CACD,CACF,CALQ,CAKN,CAACV,KAAD,CAAQP,QAAR,CAAkBK,QAAlB,CALM,CAAT,CAOA;AACAnC,SAAS,CAAC,UAAM,CACd,GAAIuB,SAAJ,CAAe,CACbO,QAAQ,CAACf,OAAO,CAACQ,SAAD,CAAYG,GAAZ,CAAR,CAAR,CACD,CACF,CAJQ,CAIN,CAACI,QAAD,CAAWP,SAAX,CAAsBG,GAAtB,CAJM,CAAT,CAMA;AACA,GAAMsB,CAAAA,oBAAoB,CAAG,QAAvBA,CAAAA,oBAAuB,CAACvB,EAAD,CAAQ,CACnCK,QAAQ,CAACd,UAAU,CAACS,EAAD,CAAX,CAAR,CACD,CAFD,CAIA;AACA,GAAMwB,CAAAA,cAAc,CAAG,QAAjBA,CAAAA,cAAiB,CAACC,CAAD,CAAO,CAC5B9B,OAAO,CAAC+B,IAAR,CAAa,0BAAb,EACD,CAFD,CAIA,mBACE,MAAC,GAAD,yBACE,KAAC,IAAD,EAAM,KAAK,CAAC,4BAAZ,EADF,cAEE,MAAC,GAAD,EAAK,EAAE,CAAE,CAAT,wBACE,sCADF,CAEG,CAAClB,SAAS,CAACmB,MAAX,cACC,MAAC,OAAD,gDACsB,KAAC,IAAD,EAAM,EAAE,CAAC,GAAT,sBADtB,CACmD,GADnD,GADD,cAKC,KAAC,SAAD,EAAW,OAAO,CAAC,OAAnB,UACGnB,SAAS,CAACoB,GAAV,CAAc,SAACZ,IAAD,qBACb,KAAC,SAAD,CAAW,IAAX,wBACE,MAAC,GAAD,EACE,KAAK,CAAE,CACLa,OAAO,CAAE,MADJ,CAELC,UAAU,CAAE,QAFP,CADT,wBAME,KAAC,GAAD,EAAK,EAAE,CAAE,CAAT,uBACE,KAAC,KAAD,EACE,SAAS,CAAC,eADZ,CAEE,GAAG,CAAEd,IAAI,CAACe,KAFZ,CAGE,GAAG,CAAEf,IAAI,CAACgB,IAHZ,CAIE,KAAK,KAJP,CAKE,OAAO,KALT,EADF,EANF,cAeE,KAAC,GAAD,EAAK,EAAE,CAAE,CAAT,uBACE,KAAC,IAAD,EAAM,EAAE,oBAAchB,IAAI,CAACiB,OAAnB,CAAR,UAAuCjB,IAAI,CAACgB,IAA5C,EADF,EAfF,cAkBE,MAAC,GAAD,EACE,EAAE,CAAE,CADN,CAEE,SAAS,CAAC,kBAFZ,CAGE,KAAK,CAAE,CACLF,UAAU,CAAE,QADP,CAELI,cAAc,CAAE,cAFX,CAHT,WAQGlB,IAAI,CAACmB,KAAL,CAAWC,cAAX,CAA0B,OAA1B,CAAmC,CAClCC,qBAAqB,CAAE,CADW,CAElCC,KAAK,CAAE,UAF2B,CAGlCC,QAAQ,CAAE,KAHwB,CAAnC,CARH,cAcE,oCACE,UACE,KAAK,CAAE,CAAEC,QAAQ,CAAE,OAAZ,CADT,CAEE,SAAS,CAAC,cAFZ,EADF,CAIK,GAJL,CAKGxB,IAAI,CAACf,GALR,GAdF,GAlBF,cAyCE,MAAC,GAAD,EACE,EAAE,CAAE,CADN,CAEE,SAAS,CAAC,kBAFZ,CAGE,KAAK,CAAE,CACL6B,UAAU,CAAE,QADP,CAELI,cAAc,CAAE,eAFX,CAHT,wBAQE,MAAC,WAAD,EAAa,aAAW,WAAxB,wBACE,KAAC,MAAD,EACE,KAAK,CAAE,CACLO,OAAO,CAAE,MADJ,CAELC,WAAW,CAAE,iBAFR,CADT,CAKE,QAAQ,CAAE1B,IAAI,CAACf,GAAL,EAAYe,IAAI,CAAC2B,YAL7B,CAME,OAAO,CAAE,kBAAM,CACbtC,QAAQ,CAACf,OAAO,CAAC0B,IAAI,CAACiB,OAAN,CAAe9B,MAAM,CAACa,IAAI,CAACf,GAAL,CAAW,CAAZ,CAArB,CAAR,CAAR,CACD,CARH,CASE,OAAO,CAAC,SATV,uBAWE,UAAG,SAAS,CAAC,aAAb,EAXF,EADF,cAcE,KAAC,MAAD,EACE,KAAK,CAAE,CACLwC,OAAO,CAAE,MADJ,CAELG,UAAU,CAAE,iBAFP,CADT,CAKE,OAAO,CAAC,SALV,CAME,QAAQ,CAAE5B,IAAI,CAACf,GAAL,GAAa,CANzB,CAOE,OAAO,CAAE,kBAAM,CACbI,QAAQ,CAACf,OAAO,CAAC0B,IAAI,CAACiB,OAAN,CAAe9B,MAAM,CAACa,IAAI,CAACf,GAAL,CAAW,CAAZ,CAArB,CAAR,CAAR,CACD,CATH,uBAWE,UAAG,SAAS,CAAC,cAAb,EAXF,EAdF,GARF,cAoCE,KAAC,MAAD,EACE,IAAI,CAAC,QADP,CAEE,OAAO,CAAE,yBAAMsB,CAAAA,oBAAoB,CAACP,IAAI,CAACiB,OAAN,CAA1B,EAFX,uBAIE,UAAG,SAAS,CAAC,cAAb,EAJF,EApCF,GAzCF,cAqFE,MAAC,GAAD,EACE,SAAS,CAAC,uBADZ,CAEE,KAAK,CAAE,CACLH,UAAU,CAAE,QADP,CAELI,cAAc,CAAE,eAFX,CAFT,wBAOE,aACE,SAAS,CAAC,QADZ,CAEE,KAAK,CAAE,CACLM,QAAQ,CAAE,OADL,CAELK,KAAK,CAAE,KAFF,CAFT,WAOG7B,IAAI,CAACmB,KAAL,CAAWC,cAAX,CAA0B,OAA1B,CAAmC,CAClCC,qBAAqB,CAAE,CADW,CAElCC,KAAK,CAAE,UAF2B,CAGlCC,QAAQ,CAAE,KAHwB,CAAnC,CAPH,cAaE,aAAK,SAAS,CAAC,MAAf,wBACE,UACE,KAAK,CAAE,CACLC,QAAQ,CAAE,OADL,CADT,CAIE,SAAS,CAAC,cAJZ,EADF,CAMK,GANL,CAOGxB,IAAI,CAACf,GAPR,GAbF,GAPF,cA+BE,aACE,SAAS,CAAC,QADZ,CAEE,KAAK,CAAE,CACL6B,UAAU,CAAE,QADP,CAELI,cAAc,CAAE,eAFX,CAGLW,KAAK,CAAE,KAHF,CAFT,wBAQE,KAAC,MAAD,EACE,IAAI,CAAC,QADP,CAEE,OAAO,CAAE,yBAAMtB,CAAAA,oBAAoB,CAACP,IAAI,CAACiB,OAAN,CAA1B,EAFX,uBAIE,UAAG,SAAS,CAAC,cAAb,EAJF,EARF,cAcE,KAAC,MAAD,EACE,KAAK,CAAE,CACLQ,OAAO,CAAE,MADJ,CAELC,WAAW,CAAE,iBAFR,CADT,CAKE,QAAQ,CAAE1B,IAAI,CAACf,GAAL,EAAYe,IAAI,CAAC2B,YAL7B,CAME,OAAO,CAAE,kBAAM,CACbtC,QAAQ,CAACf,OAAO,CAAC0B,IAAI,CAACiB,OAAN,CAAe9B,MAAM,CAACa,IAAI,CAACf,GAAL,CAAW,CAAZ,CAArB,CAAR,CAAR,CACD,CARH,CASE,OAAO,CAAC,SATV,uBAWE,UAAG,SAAS,CAAC,aAAb,EAXF,EAdF,cA2BE,KAAC,MAAD,EACE,KAAK,CAAE,CACLwC,OAAO,CAAE,MADJ,CAELG,UAAU,CAAE,iBAFP,CADT,CAKE,OAAO,CAAC,SALV,CAME,QAAQ,CAAE5B,IAAI,CAACf,GAAL,GAAa,CANzB,CAOE,OAAO,CAAE,kBAAM,CACbI,QAAQ,CAACf,OAAO,CAAC0B,IAAI,CAACiB,OAAN,CAAe9B,MAAM,CAACa,IAAI,CAACf,GAAL,CAAW,CAAZ,CAArB,CAAR,CAAR,CACD,CATH,uBAWE,UAAG,SAAS,CAAC,cAAb,EAXF,EA3BF,GA/BF,GArFF,GADF,EAAqBe,IAAI,CAACiB,OAA1B,CADa,EAAd,CADH,EAPJ,GAFF,cAgLE,KAAC,GAAD,EAAK,EAAE,CAAE,CAAT,CAAY,SAAS,CAAC,MAAtB,uBACE,KAAC,SAAD,wBACE,MAAC,IAAD,EAAM,OAAO,CAAC,OAAd,wBACE,MAAC,SAAD,CAAW,IAAX,yBACE,YAAI,SAAS,CAAC,aAAd,wBACarC,UADb,UAEGA,UAAU,CAAG,CAAb,EAAkB,GAFrB,GADF,cAKE,wBACGY,SAAS,CACPM,MADF,CACS,SAACC,GAAD,CAAMC,IAAN,QAAeD,CAAAA,GAAG,CAAGC,IAAI,CAACf,GAAL,CAAWe,IAAI,CAACmB,KAArC,EADT,CACqD,CADrD,EAEEC,cAFF,CAEiB,OAFjB,CAE0B,CACvBC,qBAAqB,CAAE,CADA,CAEvBC,KAAK,CAAE,UAFgB,CAGvBC,QAAQ,CAAE,KAHa,CAF1B,CADH,EALF,GADF,cAgBE,KAAC,SAAD,CAAW,IAAX,wBACE,YAAK,SAAS,CAAC,QAAf,uBACE,KAAC,MAAD,EACE,IAAI,CAAC,QADP,CAEE,IAAI,CAAC,IAFP,CAGE,QAAQ,CAAE,CAAC/B,SAAS,CAACmB,MAHvB,CAIE,OAAO,CAAEH,cAJX,iCADF,EADF,EAhBF,GADF,EADF,EAhLF,GADF,CAoND,CA7QD,CA+QA,cAAehC,CAAAA,QAAf","sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport { Link } from \"react-router-dom\";\r\nimport {\r\n  Row,\r\n  Col,\r\n  Image,\r\n  ButtonGroup,\r\n  ListGroup,\r\n  Button,\r\n  Card,\r\n} from \"react-bootstrap\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport Meta from \"../components/Meta\";\r\nimport Message from \"../components/Message\";\r\nimport { refreshLogin, getUserDetails } from \"../actions/userActions\";\r\nimport { addItem, removeItem } from \"../actions/cartActions\";\r\n\r\nconst CartPage = ({ match, location, history }) => {\r\n  const [totalItems, setTotalItems] = useState(0);\r\n  const productID = match.params.id;\r\n  const qty = location.search ? Number(location.search.split(\"=\")[1]) : 1; // fetch from the query string\r\n  const dispatch = useDispatch();\r\n\r\n  // get cart, userInfo and userdetails from redux store\r\n  const cart = useSelector((state) => state.cart);\r\n  const { cartItems } = cart;\r\n\r\n  const userLogin = useSelector((state) => state.userLogin);\r\n  const { userInfo } = userLogin;\r\n\r\n  const userDetails = useSelector((state) => state.userDetails);\r\n  const { error } = userDetails;\r\n\r\n  // get user details depending on what type of login it is, dispatch with correspnding argument\r\n  useEffect(() => {\r\n    userInfo\r\n      ? userInfo.isSocialLogin\r\n        ? dispatch(getUserDetails(userInfo.id))\r\n        : dispatch(getUserDetails(\"profile\"))\r\n      : dispatch(getUserDetails(\"profile\"));\r\n  }, [userInfo, dispatch]);\r\n\r\n  // store total items to local state\r\n  useEffect(() => {\r\n    if (cartItems) {\r\n      setTotalItems(cartItems.reduce((acc, item) => acc + item.qty, 0));\r\n    }\r\n  }, [cartItems]);\r\n\r\n  // if userdetails shows error, then use refresh token to get new access tokens\r\n  useEffect(() => {\r\n    if (error && userInfo && !userInfo.isSocialLogin) {\r\n      const user = JSON.parse(localStorage.getItem(\"userInfo\"));\r\n      user && dispatch(refreshLogin(user.email));\r\n    }\r\n  }, [error, dispatch, userInfo]);\r\n\r\n  // add item to cart\r\n  useEffect(() => {\r\n    if (productID) {\r\n      dispatch(addItem(productID, qty));\r\n    }\r\n  }, [dispatch, productID, qty]);\r\n\r\n  // remove item from cart\r\n  const handleRemoveFromCart = (id) => {\r\n    dispatch(removeItem(id));\r\n  };\r\n\r\n  // proceed to shipping address page, which is the next step in placing an order\r\n  const handleCheckout = (e) => {\r\n    history.push(\"/login?redirect=shipping\");\r\n  };\r\n\r\n  return (\r\n    <Row>\r\n      <Meta title=\"My Cart | The Style Studio\" />\r\n      <Col md={8}>\r\n        <h1>Shopping Cart.</h1>\r\n        {!cartItems.length ? (\r\n          <Message>\r\n            Your Cart is empty. <Link to=\"/\">Go Back.</Link>{\" \"}\r\n          </Message>\r\n        ) : (\r\n          <ListGroup variant=\"flush\">\r\n            {cartItems.map((item) => (\r\n              <ListGroup.Item key={item.product}>\r\n                <Row\r\n                  style={{\r\n                    display: \"flex\",\r\n                    alignItems: \"center\",\r\n                  }}\r\n                >\r\n                  <Col md={2}>\r\n                    <Image\r\n                      className=\"product-image\"\r\n                      src={item.image}\r\n                      alt={item.name}\r\n                      fluid\r\n                      rounded\r\n                    />\r\n                  </Col>\r\n                  <Col md={4}>\r\n                    <Link to={`/product/${item.product}`}>{item.name}</Link>\r\n                  </Col>\r\n                  <Col\r\n                    md={3}\r\n                    className=\"d-none d-md-flex\"\r\n                    style={{\r\n                      alignItems: \"center\",\r\n                      justifyContent: \"space-evenly\",\r\n                    }}\r\n                  >\r\n                    {item.price.toLocaleString(\"en-US\", {\r\n                      maximumFractionDigits: 2,\r\n                      style: \"currency\",\r\n                      currency: \"USD\",\r\n                    })}\r\n\r\n                    <div>\r\n                      <i\r\n                        style={{ fontSize: \"0.7em\" }}\r\n                        className=\"fas fa-times\"\r\n                      />{\" \"}\r\n                      {item.qty}\r\n                    </div>\r\n                  </Col>\r\n                  {/* display this col only for larger screens */}\r\n                  <Col\r\n                    md={3}\r\n                    className=\"d-none d-md-flex\"\r\n                    style={{\r\n                      alignItems: \"center\",\r\n                      justifyContent: \"space-between\",\r\n                    }}\r\n                  >\r\n                    <ButtonGroup aria-label=\"Addtocart\">\r\n                      <Button\r\n                        style={{\r\n                          outline: \"none\",\r\n                          borderRight: \"1px solid white\",\r\n                        }}\r\n                        disabled={item.qty >= item.countInStock}\r\n                        onClick={() => {\r\n                          dispatch(addItem(item.product, Number(item.qty + 1)));\r\n                        }}\r\n                        variant=\"primary\"\r\n                      >\r\n                        <i className=\"fas fa-plus\" />\r\n                      </Button>\r\n                      <Button\r\n                        style={{\r\n                          outline: \"none\",\r\n                          borderLeft: \"1px solid white\",\r\n                        }}\r\n                        variant=\"primary\"\r\n                        disabled={item.qty === 1}\r\n                        onClick={() => {\r\n                          dispatch(addItem(item.product, Number(item.qty - 1)));\r\n                        }}\r\n                      >\r\n                        <i className=\"fas fa-minus\" />\r\n                      </Button>\r\n                    </ButtonGroup>\r\n                    <Button\r\n                      type=\"button\"\r\n                      onClick={() => handleRemoveFromCart(item.product)}\r\n                    >\r\n                      <i className=\"fas fa-trash\" />\r\n                    </Button>\r\n                  </Col>\r\n                  {/* display this col only on mobile screens */}\r\n                  <Col\r\n                    className=\"d-flex d-md-none mt-2\"\r\n                    style={{\r\n                      alignItems: \"center\",\r\n                      justifyContent: \"space-between\",\r\n                    }}\r\n                  >\r\n                    <div\r\n                      className=\"d-flex\"\r\n                      style={{\r\n                        fontSize: \"1.2em\",\r\n                        width: \"50%\",\r\n                      }}\r\n                    >\r\n                      {item.price.toLocaleString(\"en-US\", {\r\n                        maximumFractionDigits: 2,\r\n                        style: \"currency\",\r\n                        currency: \"USD\",\r\n                      })}\r\n\r\n                      <div className=\"ms-1\">\r\n                        <i\r\n                          style={{\r\n                            fontSize: \"0.7em\",\r\n                          }}\r\n                          className=\"fas fa-times\"\r\n                        />{\" \"}\r\n                        {item.qty}\r\n                      </div>\r\n                    </div>\r\n\r\n                    <div\r\n                      className=\"d-flex\"\r\n                      style={{\r\n                        alignItems: \"center\",\r\n                        justifyContent: \"space-between\",\r\n                        width: \"50%\",\r\n                      }}\r\n                    >\r\n                      <Button\r\n                        type=\"button\"\r\n                        onClick={() => handleRemoveFromCart(item.product)}\r\n                      >\r\n                        <i className=\"fas fa-trash\" />\r\n                      </Button>\r\n                      <Button\r\n                        style={{\r\n                          outline: \"none\",\r\n                          borderRight: \"1px solid white\",\r\n                        }}\r\n                        disabled={item.qty >= item.countInStock}\r\n                        onClick={() => {\r\n                          dispatch(addItem(item.product, Number(item.qty + 1)));\r\n                        }}\r\n                        variant=\"primary\"\r\n                      >\r\n                        <i className=\"fas fa-plus\" />\r\n                      </Button>\r\n                      <Button\r\n                        style={{\r\n                          outline: \"none\",\r\n                          borderLeft: \"1px solid white\",\r\n                        }}\r\n                        variant=\"primary\"\r\n                        disabled={item.qty === 1}\r\n                        onClick={() => {\r\n                          dispatch(addItem(item.product, Number(item.qty - 1)));\r\n                        }}\r\n                      >\r\n                        <i className=\"fas fa-minus\" />\r\n                      </Button>\r\n                    </div>\r\n                  </Col>\r\n                </Row>\r\n              </ListGroup.Item>\r\n            ))}\r\n          </ListGroup>\r\n        )}\r\n      </Col>\r\n      <Col md={4} className=\"mt-3\">\r\n        <ListGroup>\r\n          <Card variant=\"flush\">\r\n            <ListGroup.Item>\r\n              <h2 className=\"text-center\">\r\n                Subtotal ({totalItems}) Item\r\n                {totalItems > 1 && \"s\"}\r\n              </h2>\r\n              <strong>\r\n                {cartItems\r\n                  .reduce((acc, item) => acc + item.qty * item.price, 0)\r\n                  .toLocaleString(\"en-US\", {\r\n                    maximumFractionDigits: 2,\r\n                    style: \"currency\",\r\n                    currency: \"USD\",\r\n                  })}\r\n              </strong>\r\n            </ListGroup.Item>\r\n            <ListGroup.Item>\r\n              <div className=\"d-grid\">\r\n                <Button\r\n                  type=\"button\"\r\n                  size=\"lg\"\r\n                  disabled={!cartItems.length}\r\n                  onClick={handleCheckout}\r\n                >\r\n                  Proceed to checkout\r\n                </Button>\r\n              </div>\r\n            </ListGroup.Item>\r\n          </Card>\r\n        </ListGroup>\r\n      </Col>\r\n    </Row>\r\n  );\r\n};\r\n\r\nexport default CartPage;\r\n"]},"metadata":{},"sourceType":"module"}